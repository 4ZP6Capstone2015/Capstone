\documentclass[journal,12pt,onecolumn,draftclsnofoot]{report}
%for 
%double spacing
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{fullpage}
\usepackage[sectionbib]{chapterbib}
\usepackage{subfiles}
\usepackage[noadjust]{cite}
\usepackage[round,numbers]{natbib}
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{float}
\usepackage{../ltx/edcomms}
%%\usepackage{../ltx/setupComments} directly copy-pasted on Ln 140, to allow ``commentsFalse''
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{changepage}
\usepackage{adjustbox}
\usepackage{graphicx}
\usepackage[section]{placeins} % Prevents floats from floating across sections
\usepackage{tabularx}
\usepackage{ltablex} %% Multi page tables 
\usepackage{amsfonts}
\usepackage{glossaries}
\usepackage{multirow} %% Used for Traceability matrix
\usepackage{listings}
\usepackage{calc}
\usepackage[simplified]{pgf-umlcd}
\usepackage[section]{placeins}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{longtable}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{calc}
\usetikzlibrary{positioning}
\usepackage{indentfirst}
\newcolumntype{C}[1]{>{\centering}p{#1}} %% For use with tabularx


% \input{filename.tex}      %will format input document according to base doc, 
%%can nest
% \include{filename.tex} % cant nest
% \subfile{filename.tex} % used to load child docs
% \usepackage{standalone} %used for importing preamble of child docs
% \usepackage[final]{pdfpages.pdf} %used to insert pdf files; final 
%%format[pages=3-6]
%---------------------------
\let\Oldsubsection\subsection
\renewcommand{\subsection}{\FloatBarrier\Oldsubsection}
\let\Oldsubsubsection\subsubsection
\renewcommand{\subsubsection}{\FloatBarrier\Oldsubsubsection}

\newcounter{acnum}
\newcommand{\actheacnum}{AC\theacnum}
\newcommand{\acref}[1]{AC\ref{#1}}

\newcounter{ucnum}
\newcommand{\uctheucnum}{UC\theucnum}
\newcommand{\uref}[1]{UC\ref{#1}}

\newcounter{mnum}
\newcommand{\mthemnum}{M\themnum}
\newcommand{\mref}[1]{M\ref{#1}}
\makeglossary

\setlength\parindent{24pt}
% math things
\newcommand{\ra}{$\rightarrow$}

% 
\definecolor{grey}{RGB}{192,192,192}
\definecolor{applegreen}{rgb}{0.55, 0.71, 0.0}
\lstset{ %
  language=Haskell, morekeywords = {family, kind, pattern, expression},
  literate=
  {+}{{$+$}}1
  {/}{{$/$}}1 
  {*}{{$*$}}1 
  {=}{{$=\,\,\,$}}1
  {==}{{$==$}}1 
  %{/=}{{$\not\equiv$}}2
  {==}{{$\equiv$}}2
  {/=}{{$\not\equiv$}}2
  {>}{{$>$}}1 
  {<}{{$<$}}1 
  {\\}{{$\lambda$}}1
  {\\\\}{{\char`\\\char`\\}}1
  {>>}{$>>$}2 
  {:>>=}{{$:>>=$}}2
  %% {>>=}{{\hspace{6pt}\texttt{$>>=$}\hspace{6pt}}}2
  {->}{{$\rightarrow$} }2 
  {>=}{{$\geq$}}2 {<-}{{$\leftarrow$}}2
  {<=}{{$\leq$}}2 {=>}{{$\Rightarrow$} }2
  {|}{{$\mid$}}1 
  {forall}{{$\forall$}}1
  {exists}{{$\exists$}}1 
  {Nat}{{$\mathbb{N}$}}1
  {:\~:}{{$\equiv$}}2
  {\~}{{$\equiv$}}2
  {`In`}{{$\in$}}1
  %% {.}{{$\circ$\,\,}}1
  ,
  escapeinside={\%*}{*)},
  deletekeywords={>>,>>=,mapM,mapM_,putStrLn,putStr,toInt,show,and,sequence,String,Bool
    ,True,False,Maybe,id,Show,Ordering,Void,Just,Nothing,Int,foldr,foldl,class,instance},
  morekeywords={forall, ::, :},
  postbreak={},
  breaklines=true,                
  breakatwhitespace=true,
  %postbreak={  \mbox{\textcolor{grey}{$\rightarrow$}} },
  breakindent = 0pt,
  breakautoindent = true,
  %moredelim=[is][\itshape]{"}{"},
  morestring=[b]"
}

\lstnewenvironment{code}[0]{\renewcommand\lstlistingname{Code}%
}%
{}

\newcommand{\hstype}[2][0pt]{\attribute{\hspace*{#1}\lstinline[mathescape]|#2|}}

\newcommand{\hstypectr}[1]{\attribute{\hspace*{10pt}\lstinline[mathescape]|#1|}}

\newcommand{\hsfunc}[2][0pt]{\operation{\hspace*{#1}\lstinline[mathescape]|#2|}}


%\newcommand{\@supervisor}{}
\newcommand{\supervisor}[1]{\renewcommand{\@supervisor}{#1}}

%% Originally due to WK 
\long\def\ignore#1{}

%%%%%%%%%%%%%%%%%%%%%%%
%% Turn off Edcomms before Final Submission %%
%%%%%%%%%%%%%%%%%%%%%%%

\edcommsfalse

%%% Comments are also included through setupComments.sty
%%% in all our other files.
\newif\ifcomments\commentsfalse %% ``false'' => no comments
\ifcomments
\newcommand{\authornote}[3]{\textcolor{#1}{[#3 ---#2]}}
\newcommand{\todo}[1]{\textcolor{red}{[TODO: #1]}}
\else
\newcommand{\authornote}[3]{}
\newcommand{\todo}[1]{}
\fi
\newcommand{\wss}[1]{\authornote{magenta}{SS}{#1}}
\newcommand{\ds}[1]{\authornote{blue}{DS}{#1}}
\newcommand{\ys}[1]{\authornote{green}{YS}{#1}}


%%\end{filecontents*}
\makeindex

\begin{document}
%\maketitle %% Title page included from Title.tex
\input{title}
%\edcomm{WK}{Consider using documentclass \texttt{report} instead of
 % \texttt{article}.
 % (This would mean that you have to change
%  \texttt{\backslash{}section} to \texttt{\backslash{}chapter}
%  and
%  \texttt{\backslash{}subsection} to \texttt{\backslash{}section}
%  etc.)

\newpage


\begin{abstract}
%light description
Ampersand Tarski is a tool used to produce functional software documents based 
on business process requirements.
At times, atomic state changes cannot be accepted as transactions
since they violate system invariants specified in the requirements.
When a system invariant violation occurs, one of two 
things can happen: the change that is meant to take place is adjusted (where it 
no longer violates the rules of the system) or the change is
discarded. The ultimate purpose of Event-Condition-Action rules for Ampersand 
(EFA) is to replace Ampersand's ``ExecEngine''
which is currently used to fix system violations. However, the ExecEngine 
relies on manual formulation of repair actions in an error-prone setup that 
creates PHP-embedded SQL commands from string fragments, as opposed to using 
the automatically-generated Event-Condition-Action (ECA) rules that Ampersand 
already produces. The EFA project aims to ultimately make the ExecEngine 
superfluous by correctly translating the ECA rules and implementing them as SQL 
queries so that system violations may be automatically corrected. EFA is 
automated and requires no additional work from the user. In addition, the 
generated SQL produced by EFA is, by construction, syntax-correct and type-correct. 
Furthermore, EFA has a high degree of modularity as it only relies on 
Ampersand's essential components.
\end{abstract}
\newpage
\tableofcontents
\newpage
\newpage

\chapter{Introduction}\label{Intro}
%\section{Introduction}\label{Intro}

This document is a guide for the EFA project and includes 

\begin{itemize}
\item an brief introduction 
to Ampersand
\item the software requirements used to implement EFA
\item development and design of EFA, describing each module of EFA
\item a description of software testing done on the system.
\end{itemize}

\section{Document Guide}

The first chapter covers 
the basics of Ampersand, the purpose of the project, the intended audience 
(i.e. our stakeholders), tools used to run Ampersand and terminology which will 
be used throughout this guide. 

The second chapter provides an overview of EFA's requirements specifications; 
it is divided into Ampersand system requirements and the EFA project 
requirements.
%\edreplace{YS}{Replace : The third chapter focuses on design implementation and provides 
%key information on EFA modules. In addition, it provides an outline of the 
%AMMBR algorithm, which is used to generate ECA rules, and of
%communication protocols which \edcomm{WK}{???} explains 
%how EFA communicates with Ampersand's front end.
%A lot of the proof \edcomm{WK}{???} written to 
%verify EFA's correctness is embedded within each module which is covered in 
%this section.}
%% \newline

The third chapter details the module system of EFA, as well as the design principles
which guided said module system. EFA, as well as the core Ampersand system, is
currently in active development where changes occur frequently. Commonly
accepted practice for this situation is to decompose modules based on the
principle of abstraction, where unnecessary information in hidden for the
benefit of designers and maintainers\citep{modStruct,Parnas1972}.

The fourth section covers testing, specifically, it covers property testing 
using QuickCheck and testing MySQL queries using WorkBench.
Lastly, the Appendix 
covers a variety of information such as tips for setting up 
Ampersand, literate source code, and notes on issues that came up during the 
course of EFA's 
implementation. \edcomm{WK}{I hope there will also be literate source
  code in the appendix.}

\section{Ampersand}

\edcomm{WK}{\TeX{} source becomes more maintainable if you break lines
  at the ends of grammatical units, in particular of sentences.}

\indent
The motivation behind Ampersand comes from requirements engineering, which is a 
large part of designing software systems. One of the greatest challenges of 
requirements engineering is translating informal business requirements into 
formal functional specifications. Business requirements contain ambiguity 
because they are written in a natural language with the intention of being 
easily understood by humans; however,
functional specifications must be written in a formal language that is 
unambiguous and precise. Typically, this translation of business requirements 
to a formal specification is done by a requirements
engineer, which can be prone to human error.

Ampersand offers an alternative solution which translates the natural language 
used in business process into requirement specifications
\cite{ruledesign}\edcomm{WK}{This is not recognisable as a
  reference. Choose a different bibliographystle?}. 
Ampersand is a 
software system which offers many tools that aid their clients in the 
translation process from business requirement to formal requirement 
specifications. EFA is implemented as an internal component of Ampersand that 
is meant to automate the correction of system invariants. EFA helps reduce the 
amount of manual labour required by the user by executing SQL queries to fix 
data violations. %---- edit here 

Given a set of data and a set of rules used to operate on the data, Ampersand 
is able to determine \edchange{WK}{if}{whether} there are discrepancies between the two sets.
\eddelete{YS}{Delete : Discrepancies often occur when changes
 are made to the set of data Ampersand is 
given or to the set of rules that as associated with them} 
%\edcomm{WK}{Changes to the set of rules? ``Regenerage database''!}
Data discrepancies are violations or illegal transactions
that occur in the Ampersand system
when a set of data fails to follow the rules given by the user.
When a system violation occurs,
one of two things can happen: the change that is meant to 
take place is adjusted (where it no longer violates the rules the user 
provides) or the change is discarded. EFA enhances the Ampersand system by 
translating ECA rules and executing them as SQL queries to correct system 
violations and safeguard the database from \edchange{WK}{wrongful
  transactions}{transactions that would violate the business rules}.

%%% Section includes
%%% 1) Purpose of the Project
%%% 2) Stake-Holders
\input{bus-section}

\subsection{Ampersand In Practice}

The Ampersand system is implemented in Haskell and relies on external software 
tools to help generate a prototype and its supporting documents.
On \edchange{WK}{windows}{MS Windows}, 
there is an executable available, but on Linux and Mac operating systems it 
requires installing \edchange{WK: ?}{stack}{``stackage''} (The Haskell Tool Stack)
to build Ampersand from source. 
Instructions on how to install the tools and components listed in this section 
can be found in the appendix.

\subsection*{Glasgow Haskell Compiler}

Ampersand requires the Glasgow Haskell Compiler (GHC) \cite{ghcUserGuide}, at least version 
7.10.3 to compiler Ampersand source code. 

\subsection*{Ampersand's GitHub}\label{Github}

Github hosts the most current version of the Ampersand system. Github is used 
to maintain consistency between the main Ampersand branch and this project. The 
most recent version of Ampersand can be found at 
\cite{ampersandGit}\edinsert{WK}{.}
\edcomm{WK}{Not optically recognisable as link in the PDF --- this is a global problem.}
\edcomm{YT}{It works for me! (and for Yash as well)}

\subsection*{Graphviz}

Graphviz \cite{graphviz}
 is an open source graph visualization software that Ampersand uses to generate 
 artifacts\edchange{WK}{,}{;} specifically it is used to create graphics for the prototype's 
 requirement documentation. Graphviz is able to take descriptions of graphs in 
 simple text and create diagrams from them. 

\subsection*{The Cabal System}

%% \edcomm{WK}{This is part of the Haskell Platform.}
%% `HP' is a typo - should be `GHC'
 

The Cabal System \cite{cabalsys} is used for building 
and packaging Haskell libraries and programs. 
Cabal describes what a Haskell package is, how these packages interact with the 
language, and what must be implemented to support the packages that are used. 
It is part of a larger infrastructure used to distribute, organize, and catalog 
Haskell programs and their associated libraries. The Cabal build system
also uses the Hackage \cite{hackage} Haskell source repository.

\subsection*{The Haskell Tool Stack}

The Haskell Tool Stack \cite{cabalsys} is used to 
install the most recent version of Ampersand from source code, and various 
Haskell packages (e.g., QuickCheck).

\subsection*{QuickCheck}

QuickCheck \cite{quickCheck} is used to 
test properties of functions used in EFA's modules. QuickCheck is a library for 
random testing of program properties; a programmer simply provides a 
specification of properties which functions should satisfy\edinsert{WK}{,}
and QuickCheck generates a large number of random cases to test these properties.
QuickCheck comes with a manual on how 
properties can be defined and used. 

\subsection*{MySQL WorkBench}

MySQL WorkBench \cite{workbench} is used to test 
the SQL queries generated by EFA. MySQL WorkBench is a graphical tool for MySQL 
databases and comes with a built-in editor\edchange{WK}{,}{;} in this project it is used to 
manually test queries. Through various stages in development it is used for 
data modeling.

\section{Naming Conventions and Terminology}\label{sec:Naming} 
\begin{description}
    \item[ECA] Stands for Event-Condition Action. The rule structure used for 
    data
    bases and commonly used in \edchange{WK}{market ready}{market-ready} business rule engines. ECA rules are
    used in Ampersand to describe how a database should be modified in response 
    to
    a system constraint becoming untrue. 
    
    \item [ADL] Stands for ``Abstract Data Language''
      \cite[13]{derFun}\edcomm{WK}{Look at what \LaTeX{} produces here!}.
    From a given set of formally defined business requirements, Ampersand generates a
    functional specification consisting of a data model, a service catalog, a
    formal specification of the services, and a function point analysis. An ADL
    script acts as an input for Ampersand. An ADL file consists of a plain ASCII
    text file.
    
    \item [Ampersand] Ampersand refers to the software tool described in this 
    document, as well as the method of generating functional specification from formalized
    business requirements. 
    
    \item [Business requirements] Requirements which exist due to some real 
    world 
    constraints (i.e. financial, logistic, physical or safety constraints). 
    
    \item [Business rules] See \emph{Business Requirements}.
    
    \item [EFA] Stands for ``ECA (see above) for Ampersand''. This term is used 
    to refer to the contribution of ECA to Ampersand. 
    
    \item [Functional specification] A \emph{formal} document which details the 
    operation,
    capabilities, and appearance of a software system. 
    
    \item [Natural language] Language written in a manner similar to that of 
    human 
    communication; language intended to be interpreted and understood by 
    humans, as 
    opposed to machines. 
    
    \item [Requirements engineering] The process of translating business
    requirements into a functional specification. 
    
    \item [Prototype] Ampersand generates a prototype for the user that 
    provides a 
    front-end interface that connects to a back-end database.
    
\end{description}

\input{requirements-section}
\input{design-section}
\input{testing-section}
\input{appendix}

\bibliographystyle{alpha}
\bibliography{references}

\end{document}


